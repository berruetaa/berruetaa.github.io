<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudoku Game</title>
    <style>
        table {
            border-collapse: collapse;
            margin: 20px auto;
        }
        td {
            width: 50px;
            height: 50px;
            text-align: center;
            border: 1px solid black;
            font-size: 24px;
        }
        .fixed {
            background-color: lightgray;
        }
        .timer, .scoreboard {
            text-align: center;
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Sudoku Generator -->
    <script>
        class Sudoku {
            constructor() {
                this.grid = Array.from({ length: 9 }, () => Array(9).fill(' '));
            }

            printSudoku() {
                console.log(" -----------------------------")
                for (let i = 0; i < this.grid.length; i++) {
                    if (i != 0 && i % 3 == 0) {
                        console.log(" -----------------------------")
                    }
                    let string = ""
                    for (let j = 0; j < this.grid[i].length; j++) {
                        if (j % 3 == 0) {
                            string += "|"
                        }
                        string += " " + this.grid[i][j] + " "
                    }
                    console.log(string + "|")
                }
                console.log(" -----------------------------")
            }

            rowCheck(val, index) {
                return this.grid[index].includes(val)
            }

            colCheck(val, index) {
                for (let i = 0; i < 9; i++) {
                    if (this.grid[i][index] == val) {
                        return true
                    }
                }
                return false
            }

            subgrid(val, row, col) {
                for (let i = Math.floor(row / 3) * 3; i < (Math.floor(row / 3) * 3) + 3; i++) {
                    for (let j = Math.floor(col / 3) * 3; j < (Math.floor(col / 3) * 3) + 3; j++) {
                        if (this.grid[i][j] == val) {
                            return true
                        }
                    }
                }
                return false
            }

            generateSudoku(dif) {
                let num = "123456789"
                for (let i = 0; num.length > 0 && i < 9; i++) {
                    let index = Math.floor(Math.random() * num.length)
                    let val = num.substring(index, index + 1)
                    this.grid[0][i] = val
                    num = num.replace(val, '')
                }

                this.solver()
                this.removeValues(dif)
            }

            removeValues(dif) {
                for (let i = 0; i < dif; i++) {
                    let row = Math.floor(Math.random() * 9)
                    let col = Math.floor(Math.random() * 9)
                    this.grid[row][col] = ' '
                }
            }

            solver() {
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        if (this.grid[i][j] == ' ') {
                            for (let val = 1; val < 10; val++) {
                                if (!(this.rowCheck(val, i) || this.colCheck(val, j) || this.subgrid(val, i, j))) {
                                    this.grid[i][j] = val
                                    if (this.solver()) {
                                        return true
                                    }
                                    this.grid[i][j] = ' '
                                }
                            }
                            return false
                        }
                    }
                }
                return true
            }
        }
    </script>
</head>
<body>
    <div class="timer" id="timer">Time: 0s</div>
    <table id="sudoku">
        <!-- Sudoku table will be generated here -->
    </table>
    <div class="scoreboard" id="scoreboard">
        <h2>Scoreboard</h2>
        <ul id="scores">
            <!-- Scores will be displayed here -->
        </ul>
    </div>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        function saveScore(time) {
            const name = prompt("Enter your name:");
            if (name) {
                database.ref('scores/').push({
                    name: name,
                    time: time
                });
            }
        }

        function loadScores() {
            const scoresList = document.getElementById('scores');
            scoresList.innerHTML = '';
            database.ref('scores/').orderByChild('time').limitToFirst(10).on('value', (snapshot) => {
                snapshot.forEach((data) => {
                    const li = document.createElement('li');
                    li.textContent = `${data.val().name}: ${data.val().time}s`;
                    scoresList.appendChild(li);
                });
            });
        }

        const table = document.getElementById('sudoku');
        let solvedBoard = [];
        let seconds = 0;
        const timerElement = document.getElementById('timer');
        let timerInterval;

        function createSudokuTable(board) {
            table.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const row = document.createElement('tr');
                for (let j = 0; j < 9; j++) {
                    const cell = document.createElement('td');
                    if (board[i][j] !== ' ') {
                        cell.textContent = board[i][j];
                        cell.classList.add('fixed');
                    } else {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.maxLength = 1;
                        input.style.width = '100%';
                        input.style.height = '100%';
                        input.style.border = 'none';
                        input.style.textAlign = 'center';
                        input.style.fontSize = '24px';
                        input.addEventListener('input', validateInput);
                        cell.appendChild(input);
                    }
                    row.appendChild(cell);
                }
                table.appendChild(row);
            }
        }

        function validateInput(event) {
            const value = event.target.value;
            if (isNaN(value) || value < 1 || value > 9) {
                event.target.value = '';
            } else {
                checkCompletion();
            }
        }

        function checkCompletion() {
            const inputs = table.querySelectorAll('input');
            let completed = true;
            inputs.forEach((input, index) => {
                const row = Math.floor(index / 9);
                const col = index % 9;
                if (input.value != solvedBoard[row][col]) {
                    completed = false;
                }
            });
            if (completed) {
                clearInterval(timerInterval);
                saveScore(seconds);
                loadScores();
            }
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                seconds++;
                timerElement.textContent = `Time: ${seconds}s`;
            }, 1000);
        }

        window.onload = function() {
            const sudoku = new Sudoku();
            sudoku.generateSudoku(50);
            const puzzle = sudoku.grid.map(row => row.join(''));
            const solved = sudoku.grid.map(row => row.slice());
            sudoku.solver();
            solvedBoard = sudoku.grid;
            createSudokuTable(puzzle);
            startTimer();
            loadScores();
        }
    </script>
</body>
</html>